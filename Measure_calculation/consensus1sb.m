
clear all

%assisi
%A = [0 1 0 1 0; 1 0 1 0 1; 0 1 0 0 0; 1 0 0 0 1; 0 1 0 1 0 ];

%assisi (c conected with e)
%A = [0 1 0 1 0; 1 0 1 0 1; 0 1 0 0 1; 1 0 0 0 1; 0 1 1 1 0 ];

% star
%A = [0 1 0 1 1; 1 0 1 0 1; 0 1 0 1 1; 1 0 1 0 1; 1 1 1 1 0 ];

%line
%A = [0 1 0; 1 0 1; 0 1 0];

%symetrical
%A = [0 0 1 0 0 0 0; 0 0 1 0 0 0 0; 1 1 0 1 0 0 0; 0 0 1 0 1 0 0; 0 0 0 1 0 1 1; 0 0 0 0 1 0 0; 0 0 0 0 1 0 0];

%rect
%A = [0 1 0 0 1 1 0 0 0;
%     1 0 1 0 1 1 0 0 0;
%     0 1 0 1 0 0 1 0 0;
%     0 0 1 0 0 0 0 1 0;
%     1 1 0 0 0 1 0 0 0;
%     1 1 0 0 1 0 1 0 0;
%     0 0 1 0 0 1 0 1 0;
%     0 0 0 1 0 0 1 0 1;
%     0 0 0 0 0 0 0 1 0];

%star 2
%A = [0 1 1 1 1 1 1 1 1;
%     1 0 0 0 0 0 0 0 0;
%     1 0 0 0 0 0 0 0 0;
%     1 0 0 0 0 0 0 0 0;
%     1 0 0 0 0 0 0 0 0;
%     1 0 0 0 0 0 0 0 0;
%     1 0 0 0 0 0 0 0 0;
%     1 0 0 0 0 0 0 0 0;
%     1 0 0 0 0 0 0 0 0];

A = [0 1 0 1 0 1 0 1 0 0 0 0 0 0 0 0 ;
     1 0 1 0 0 0 0 0 1 1 0 0 0 0 0 0 ;
     0 1 0 0 0 0 0 0 0 0 0 0 0 1 0 0 ;
     1 0 0 0 1 0 0 0 0 0 1 0 1 0 0 0 ;
     0 0 0 1 0 0 1 0 1 0 0 0 0 0 0 0 ;
     1 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 ;
     0 0 0 0 1 0 0 0 1 0 0 0 0 0 0 0 ;
     1 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 ;
     0 1 0 0 1 0 1 0 0 0 0 0 0 0 0 0 ;
     0 1 0 0 0 0 0 1 0 0 0 0 0 0 1 0 ;
     0 0 0 1 0 0 0 0 0 0 0 0 0 0 1 0 ;
     0 0 0 0 0 1 0 0 0 0 0 0 1 0 1 0 ;
     0 0 0 1 0 0 0 0 0 0 0 1 0 0 1 0 ;
     0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 1 ;
     0 0 0 0 0 0 0 0 0 1 1 1 1 0 0 0 ;
     0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 ];

% A = [0 1 0 1 0 1 0 1 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 1 0 0 0 0 0 0;
%     1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
%     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 1 0 0 0;
%     1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1;
%     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 1;
%     1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
%     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 1;
%     1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
%     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 0 0 0 1 0 0 0 0 0 0;
%     0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
%     0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
%     0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
%     0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
%     0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
%     0 0 0 0 0 0 0 0 0 1 1 1 1 1 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0;
%     0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 1 0 0;
%     1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 1 0 0;
%     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1;
%     0 0 0 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0;
%     0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0;
%     0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
%     0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
%     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
%     1 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0;
%     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1;
%     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 1 0 0 0;
%     0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 ;
%     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 ;
%     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 ;
%     0 0 0 1 1 0 1 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 1 0 0 0 0 0 ];
 


% x=0.5*[1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1];
x=0.5*[1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1];
%x = [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5];
%x =  [0.5 0.5 0.5 0.5 0.5 0.5 0.5];
%x =  [0.5 0.5 0.5 0.5 0.5];
%x = [0.5 0.5 0.5];

G = graph(A);
a = plot(G);
L = laplacian(G);

brj = 0;
v_qty_max = sum([A+eye(length(A))]*(2*x)')

for j = 1:2^(length(x))
    x_vec = dec2bin(j-1,length(x)) - '0';
    v_qty = [A+eye(length(A))]*x_vec';
    qty(j,:) = sum(v_qty);
        for k = 1:length(x)
            if v_qty(k) == 0
            qty(j,:) = v_qty_max;
            end
        end             
end

for i = 1:5000
brj = brj+1;
[sumpwr,x] = consensus(A,L,x,brj);
izl(i,:)=x;
qlty(i,:)=sum([A+eye(length(A))]*x');
spwr(i,:)=sumpwr/qlty(i,:);
end

izl(i,:)
([A+eye(length(A))]*x')'
qlty(i,:)
sumpwr

figure
plot(izl)
figure
plot(spwr)
figure
plot(qlty)
figure
plot(qty)

function [sumpwr,x]= consensus(A,L,x,brj)
coeff = 0.01;
sumx = 0; %sum(x);
dx = zeros(1,length(A));
pwr = 0;

for i = 1:length(A)
    for j = 1:length(A)
    pwr = pwr + A(i,j)* (x(i)-x(j))^2;
    end
end

B = A+eye(length(A));
sumx = sum(B*x');  
sumpwr = pwr;

for i = 1:length(A) %update delta x
    dx(i) = 4*(L(i,:)* x');         
    diff(i) = (dx(i)*sumx - sumpwr*sum(B(:,i)))/(sumx^2);
    
end

for i = 1:length(A) %update x 
    x(i) = x(i) + coeff*diff(i)+coeff*0.01*(rand-0.5);
    if x(i) > 1
        x(i) = 1;
    end
    if x(i) < 0
        x(i) = 0;
    end
end
end
